const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-apexcharts.min-C_VSGAdc.js","assets/index-a8kbXjkM.js"])))=>i.map(i=>d[i]);
import{r as d,i as A,j as e,R as J,_ as V}from"./index-a8kbXjkM.js";import{C as re}from"./react-apexcharts.min-C_VSGAdc.js";import{D as z}from"./DashboardCard-NxkDkr49.js";import{c as M}from"./config-BwmyTBcy.js";import{u as W}from"./Paper-D-RdRHSj.js";import{B as S,T as Z}from"./Box-BxUS-AKn.js";import{D as ne}from"./Divider-BqRgsaQ7.js";import{S as Y}from"./Stack-Aob2kBw8.js";import{A as ie}from"./Avatar-BNewy4V1.js";import{G as N}from"./Grid2-Dw2Zx1n0.js";import"./Card-BPtRDKI0.js";import"./CardContent-ClSNjI8-.js";import"./useThemeProps-bsjAaqb7.js";import"./createSvgIcon-kD1ZWZUU.js";import"./useSlot-Dz5mhnmg.js";import"./resolveComponentProps-Bn6s_OOL.js";import"./useForkRef-Dx36i4TJ.js";import"./isMuiElement-mFh1iwH4.js";const ce=()=>{const[t,f]=d.useState(!0),[k,D]=d.useState([]),[b,v]=d.useState([]),[w,_]=d.useState([]),c=A(),h=W();h.palette.primary.main,h.palette.secondary.main,d.useEffect(()=>{(async()=>{try{const n=sessionStorage.getItem("token");if(!n){f(!1),c("/auth/login");return}const r=new Headers;r.append("authToken",n);const l=await fetch(`${M.rutaApi}employee_system_list`,{method:"GET",headers:r});if(l.status===401){sessionStorage.removeItem("token"),alert("Sesión expirada, por favor ingresa nuevamente"),c("/auth/login");return}const i=await l.json();_(i.dataEmployees||[]),f(!1)}catch(n){console.error("Error fetching data:",n),f(!1)}})()},[c]),d.useEffect(()=>{w.length>0&&y()},[w]);const p=(a,n)=>{for(const r of n){const l=a[r];if(!l)continue;const i=new Date(l);if(!isNaN(i.getTime()))return i}return null},y=()=>{const a=new Date,n=a.getFullYear(),r=n-1,l=Array.from(new Set(w.map(s=>s.customer||"Unknown Client"))).sort(),i=[],u=[],B=["start_date","hire_date","created_at","active_since","fecha_ingreso"],L=["active_until","end_date","terminacion_date","fecha_salida"],I=(s,x)=>(s==null?void 0:s.id)??(s==null?void 0:s.employee_id)??(s==null?void 0:s.document_number)??`${(s==null?void 0:s.email)??""}__${x}`,g=(s,x)=>{const E=new Set;let F=0;return s.forEach((P,T)=>{const R=I(P,T);if(E.has(R))return;const O=p(P,B),$=p(P,L),U=!O||O.getTime()<=x.getTime(),G=$&&$.getTime()<=x.getTime();U&&!G&&(F++,E.add(R))}),F},C=(s,x)=>{const E=new Set;return s.forEach((F,P)=>{const T=I(F,P),R=p(F,L);R&&R.getFullYear()===x&&E.add(T)}),E.size};for(const s of l){const x=w.filter(H=>(H.customer||"Unknown Client")===s),E=new Date(r,0,1),F=new Date(r,11,31,23,59,59,999),P=new Date(n,0,1),T=a,R=g(x,E),O=g(x,F),$=g(x,P),U=g(x,T),G=C(x,r),ee=C(x,n),te=(R+O)/2,oe=($+U)/2,q=(H,X)=>{if(X>0){const se=H/X*100,ae=Math.min(se,100);return parseFloat(ae.toFixed(1))}else return H>0?100:0},K=q(G,te),Q=q(ee,oe);i.push(K>0?K:.1),u.push(Q>0?Q:.1)}D(l),v([{name:`${r}`,data:i},{name:`${n}`,data:u}])},j={chart:{foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},zoom:{enabled:!1},events:{dataPointSelection:(a,n,r)=>{const l=k[r.dataPointIndex];l&&c(`/profiles/customerProfile?nameCustomer=${encodeURIComponent(l)}`)}}},colors:["#589992","#0D4B3B"],plotOptions:{bar:{horizontal:!1,borderRadius:6,columnWidth:"60%"}},grid:{show:!0,strokeDashArray:3,borderColor:"rgba(0,0,0,.08)"},xaxis:{categories:k,labels:{rotate:-30,rotateAlways:!0,style:{fontSize:"13px"}},axisTicks:{show:!1},axisBorder:{show:!1}},stroke:{show:!0,width:2,colors:["transparent"]},dataLabels:{enabled:!1},tooltip:{y:{formatter:a=>`${a}%`}},legend:{position:"top"}},o=Math.max(k.length*120,600);return e.jsx(z,{title:"Historic Attrition Risk",children:e.jsx(S,{sx:{height:360,width:"100%",display:"flex",flexDirection:"column"},children:t?e.jsx(S,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{variant:"body2",children:"Cargando..."})}):e.jsx(S,{sx:{overflowX:"auto",px:1,py:.5},children:e.jsx(S,{sx:{width:o,minHeight:280},children:e.jsx(re,{options:j,series:b,type:"bar",height:280,width:o})})})})})},le=J.lazy(()=>V(()=>import("./react-apexcharts.min-C_VSGAdc.js").then(t=>t.r),__vite__mapDeps([0,1]))),de=()=>{const t=W(),f=A();t.palette.primary.main,t.palette.secondary.main,t.palette.info.main,t.palette.warning.main;const[k,D]=d.useState([]),[b,v]=d.useState(!0);d.useEffect(()=>{(async()=>{try{const h=sessionStorage.getItem("token");if(!h){alert("Token defeated, enter again"),f("/auth/login");return}const p=new Headers;p.append("authToken",h);const y={method:"GET",headers:p,redirect:"follow"},m=await(await fetch(`${M.rutaApi}show_metrics_analytics_attrition`,y)).json();let o={Positive:0,Negative:0,Neutral:0,"No comment":0};m.forEach(r=>{if(r.calification)try{const l=r.calification.replace(/'/g,'"').replace(/([a-zA-Záéíóúñ]+):/g,'"$1":');let u=JSON.parse(l).Nivel;u==="Positivo"&&(u="Positive"),u==="Negativo"&&(u="Negative"),u==="Neutro"&&(u="Neutral"),u&&o.hasOwnProperty(u)?o[u]+=1:o["No comment"]+=1}catch{o["No comment"]+=1}else o["No comment"]+=1});const a=Object.values(o).reduce((r,l)=>r+l,0),n=Object.values(o).map(r=>a>0?parseFloat((r/a*100).toFixed(1)):0);D(n),v(!1)}catch(h){console.error(h),v(!1)}})()},[f]);const w=["Positive","Negative","Neutral","No comment"],_={labels:w,chart:{height:250,type:"donut",foreColor:"#adb0bb",fontFamily:"inherit",events:{dataPointSelection:(c,h,p)=>{const y=w[p.dataPointIndex];if(y){const j=y.toLowerCase().replace(" ","_");f(`/show_attrition_employee_customer/show_attrition_perspective?pers=${j}`)}}}},colors:[t.palette.success.main,t.palette.error.main,t.palette.info.main,t.palette.grey[700]],dataLabels:{enabled:!1},legend:{show:!1},stroke:{colors:["transparent"]},plotOptions:{pie:{donut:{size:"83",background:"transparent",labels:{show:!0,name:{show:!0,offsetY:7},value:{show:!1},total:{show:!0,color:"#a1aab2",fontSize:"13px",label:"Percentage %"}}}}},responsive:[{breakpoint:480,options:{chart:{height:230}}}],tooltip:{y:{formatter:function(c){return c.toFixed(1)+"%"}},theme:t.palette.mode==="dark"?"dark":"light",fillSeriesColor:!1}};return e.jsx(z,{title:"Job Satisfaction",subtitle:"",footer:e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(Y,{spacing:2,p:3,direction:"row",justifyContent:"center",flexWrap:"wrap",children:[{label:"Positive",color:t.palette.success.main},{label:"Negative",color:t.palette.error.main},{label:"Neutral",color:t.palette.info.main},{label:"No comment",color:t.palette.grey[700]}].map((c,h)=>e.jsxs(Y,{direction:"row",spacing:1,alignItems:"center",sx:{m:.5},children:[e.jsx(ie,{sx:{width:9,height:9,bgcolor:c.color,svg:{display:"none"}}}),e.jsx(Z,{variant:"subtitle2",sx:{color:c.color},children:c.label})]},h))})]}),children:e.jsx(S,{height:"220px",children:e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Cargando gráfico..."}),children:!b&&k.length>0&&e.jsx(le,{options:_,series:k,type:"donut",height:250,width:"100%"})})})})},he=J.lazy(()=>V(()=>import("./react-apexcharts.min-C_VSGAdc.js").then(t=>t.r),__vite__mapDeps([0,1]))),ue=()=>{const t=A(),[f,k]=d.useState([]),[D,b]=d.useState(!0);d.useEffect(()=>{(async()=>{try{const c=sessionStorage.getItem("token");if(!c){alert("Token defeated, enter again"),t("/auth/login");return}const h=new Headers;h.append("authToken",c);const p={method:"GET",headers:h,redirect:"follow"},j=await(await fetch(`${M.rutaApi}show_metrics_analytics_attrition`,p)).json();let m=0,o=0,a=0;j.forEach(l=>{if(l.clasification){const i=l.clasification.toLowerCase();i.includes("high")?m++:i.includes("medium")?o++:i.includes("low")&&a++}});const n=m+o+a,r=[parseFloat((m/n*100).toFixed(1)),parseFloat((o/n*100).toFixed(1)),parseFloat((a/n*100).toFixed(1))];k(r),b(!1)}catch(c){console.error(c),b(!1)}})()},[t]);const v=_=>{t(`/show_attrition_employee_customer/show_risk?risk=${encodeURIComponent(_)}`)},w={chart:{type:"radar",toolbar:{show:!1},events:{markerClick:(_,c,h)=>{const y=["High","Medium","Low"][h.dataPointIndex];y&&v(y)}}},xaxis:{categories:["High Risk","Medium Risk","Low Risk"]},markers:{size:5,colors:["#FF4560"]},stroke:{width:2,colors:["#FF4560"]},fill:{opacity:.1,colors:["#FF4560"]},yaxis:{show:!1},tooltip:{y:{formatter:_=>`${_}%`}}};return e.jsx(z,{title:"Attrition Risk",subtitle:"",children:e.jsx(Y,{direction:"row",justifyContent:"center",children:e.jsx(S,{width:"400px",children:e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Cargando gráfico..."}),children:!D&&f.length>0&&e.jsx(he,{options:w,series:[{name:"Attrition Risk",data:f}],type:"radar",height:300})})})})})},fe=J.lazy(()=>V(()=>import("./react-apexcharts.min-C_VSGAdc.js").then(t=>t.r),__vite__mapDeps([0,1]))),me=()=>{const[t,f]=d.useState(!0),[k,D]=d.useState([]),b=A(),v=W();v.palette.primary.main;const[w,_]=d.useState([]),[c,h]=d.useState([]);d.useEffect(()=>{(async()=>{try{const o=sessionStorage.getItem("token");if(!o){y("Token defeated, enter again","error"),f(!1),b("/auth/login");return}const a=new Headers;a.append("authToken",o);const n={method:"GET",headers:a,redirect:"follow"},l=await(await fetch(`${M.rutaApi}show_metrics_analytics_attrition`,n)).json(),i={};l.forEach(g=>{const C=g.customer||"Unknown Client",s=g.clasification;i[C]||(i[C]={Low:0,Mid:0,High:0}),s.includes("Low")?i[C].Low+=1:s.includes("Medium")?i[C].Mid+=1:s.includes("High")&&(i[C].High+=1)});const u=Object.keys(i),B=u.map(g=>i[g].Low),L=u.map(g=>i[g].Mid),I=u.map(g=>i[g].High);_(u),h([{name:"Low Risk",data:B},{name:"Medium Risk",data:L},{name:"High Risk",data:I}]),f(!1)}catch(o){console.error("Error fetching data:",o),f(!1)}})()},[]);const p=(m,o)=>{b(`/show_attrition_employee_customer/show_attrition_employee_customer?cliente=${encodeURIComponent(m)}&riesgo=${encodeURIComponent(o)}`)},y=(m,o)=>{D(a=>[...a,{msg:m,severity:o}])},j={chart:{type:"bar",stacked:!0,foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},events:{dataPointSelection:function(m,o,a){const n=w[a.dataPointIndex],r=c[a.seriesIndex].name;p(n,r)}}},plotOptions:{bar:{horizontal:!0,borderRadius:4,barHeight:"60%"}},xaxis:{categories:w},legend:{position:"top"},fill:{opacity:1},colors:[v.palette.success.main,v.palette.warning.main,v.palette.error.main],tooltip:{y:{formatter:m=>`${m} empleados`}}};return e.jsx(e.Fragment,{children:e.jsx(z,{title:"Risk per client",subtitle:"",children:e.jsx(S,{height:"400px",children:e.jsx(fe,{options:j,series:c,type:"bar",height:400,width:"100%"})})})})};function Ne(){return A(),e.jsx(S,{children:e.jsxs(N,{container:!0,spacing:3,children:[e.jsx(N,{size:{xs:12,lg:8},children:e.jsx(ce,{})}),e.jsx(N,{size:{xs:12,lg:4},children:e.jsx(de,{})}),e.jsx(N,{size:{xs:12,lg:4},children:e.jsx(ue,{})}),e.jsx(N,{size:{xs:12,lg:8},children:e.jsx(me,{})})]})})}export{Ne as default};
