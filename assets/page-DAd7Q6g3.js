const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-apexcharts.min-B794tETo.js","assets/index-vVrmdSAi.js"])))=>i.map(i=>d[i]);
import{r as d,i as O,j as t,R as V,_ as J}from"./index-vVrmdSAi.js";import{C as se}from"./react-apexcharts.min-B794tETo.js";import{D as M}from"./DashboardCard-DiCOlyP-.js";import{c as Y}from"./config-DOW8WNQj.js";import{u as K}from"./Paper-MwjgWMcl.js";import{B as E,T as ee}from"./Box-Dmp19RYy.js";import{D as ae}from"./Divider-BlS2FaE6.js";import{S as q}from"./Stack-MhTt_PAh.js";import{A as re}from"./Avatar-Cu8loZOr.js";import{G as $}from"./Grid2-Bg8qC2FV.js";import"./Card-BOVImWUe.js";import"./CardContent-sb6ukAQg.js";import"./useThemeProps-C78EGfwx.js";import"./createSvgIcon-BaC4K_Lt.js";import"./useSlot-CSLy36Ib.js";import"./resolveComponentProps-CQBDKyOr.js";import"./useForkRef-DlMLD4qL.js";import"./isMuiElement-DBhawjF7.js";const ne=()=>{const[h,g]=d.useState(!0),[k,P]=d.useState([]),[D,v]=d.useState([]),[y,_]=d.useState([]),c=O(),u=K();u.palette.primary.main,u.palette.secondary.main,d.useEffect(()=>{(async()=>{try{const o=sessionStorage.getItem("token");if(!o){g(!1),c("/auth/login");return}const s=new Headers;s.append("authToken",o);const a=await fetch(`${Y.rutaApi}employee_system_list`,{method:"GET",headers:s});if(a.status===401){sessionStorage.removeItem("token"),alert("Session expired, please log in again"),c("/auth/login");return}const r=await a.json();_(r.dataEmployees||[]),g(!1)}catch(o){console.error("Error fetching data:",o),g(!1)}})()},[c]),d.useEffect(()=>{y.length>0&&j()},[y]);const w=(n,o)=>{for(const s of o){const a=n[s];if(!a)continue;const r=new Date(a);if(!isNaN(r.getTime()))return r}return null},C=n=>{const o=new Date,s=o.getFullYear();return n===s?o:new Date(n,11,31,23,59,59,999)},j=()=>{const o=new Date().getFullYear(),s=o-1,a=Array.from(new Set(y.map(e=>e.customer||"Unknown Client"))),r=["start_date","hire_date","created_at","active_since","fecha_ingreso"],F=["active_until","end_date","terminacion_date","fecha_salida"],A=(e,x)=>(e==null?void 0:e.id)??(e==null?void 0:e.employee_id)??(e==null?void 0:e.document_number)??`${(e==null?void 0:e.email)??""}__${x}`,I=e=>new Date(e,0,1,0,0,0,0),S=e=>new Date(e,11,31,23,59,59,999),m=(e,x)=>{const T=new Set;return e.forEach((R,L)=>{const H=A(R,L),N=w(R,F);N&&N.getFullYear()===x&&T.add(H)}),T.size},l=(e,x,T)=>{const R=new Set;return e.forEach((L,H)=>{const N=A(L,H);if(R.has(N))return;const B=w(L,r)??new Date(-864e13),U=w(L,F)??new Date(864e13);B.getTime()<=T.getTime()&&U.getTime()>=x.getTime()&&R.add(N)}),R.size},b=a.map(e=>{const x=y.filter(z=>(z.customer||"Unknown Client")===e),T=I(s),R=S(s),L=I(o),H=C(o),N=m(x,s),B=m(x,o),U=l(x,T,R),te=l(x,L,H),Q=(z,Z)=>{if(Z>0){const oe=z/Z*100;return parseFloat(Math.min(oe,100).toFixed(1))}else return z>0?100:0},G=Q(N,U),W=Q(B,te),X=.1;return{customer:e,prevReal:G,currReal:W,prevPlot:G>0?G:X,currPlot:W>0?W:X,basePrev:"#EDD9ED",baseCurr:"#CD9ACD"}});b.sort((e,x)=>x.currReal-e.currReal||x.prevReal-e.prevReal||e.customer.localeCompare(x.customer)),P(b.map(e=>e.customer)),v([{name:`${s}`,data:b.map(e=>({x:e.customer,y:e.prevPlot,real:e.prevReal,fillColor:e.basePrev}))},{name:`${o}`,data:b.map(e=>({x:e.customer,y:e.currPlot,real:e.currReal,fillColor:e.baseCurr}))}])},p={chart:{foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},zoom:{enabled:!1},events:{dataPointSelection:(n,o,s)=>{const a=k[s.dataPointIndex];a&&c(`/profiles/customerProfile?nameCustomer=${encodeURIComponent(a)}`)}}},colors:["#EDD9ED","#CD9ACD"],plotOptions:{bar:{horizontal:!1,borderRadius:6,columnWidth:"60%"}},grid:{show:!0,strokeDashArray:3,borderColor:"rgba(0,0,0,.08)"},xaxis:{categories:k,labels:{rotate:-30,rotateAlways:!0,style:{fontSize:"13px"}},axisTicks:{show:!1},axisBorder:{show:!1}},stroke:{show:!0,width:2,colors:["transparent"]},dataLabels:{enabled:!1},tooltip:{y:{formatter:(n,o)=>{var s,a,r,F,A,I;try{const S=(A=(F=(r=(a=(s=o==null?void 0:o.w)==null?void 0:s.config)==null?void 0:a.series)==null?void 0:r[o.seriesIndex])==null?void 0:F.data)==null?void 0:A[o.dataPointIndex],m=typeof(S==null?void 0:S.real)=="number"?S.real:void 0;return`${Number(typeof m=="number"?m:n).toFixed(1)}%`}catch{return`${((I=n.toFixed)==null?void 0:I.call(n,1))??n}%`}}}},legend:{position:"top"}},f=Math.max(k.length*120,600);return t.jsx(M,{title:"Historic Attrition Risk",children:t.jsx(E,{sx:{height:360,width:"100%",display:"flex",flexDirection:"column"},children:h?t.jsx(E,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(ee,{variant:"body2",children:"Cargando..."})}):t.jsx(E,{sx:{overflowX:"auto",px:1,py:.5},children:t.jsx(E,{sx:{width:f,minHeight:280},children:t.jsx(se,{options:p,series:D,type:"bar",height:280,width:f})})})})})},ie=V.lazy(()=>J(()=>import("./react-apexcharts.min-B794tETo.js").then(h=>h.r),__vite__mapDeps([0,1]))),ce=()=>{const h=K(),g=O();h.palette.primary.main,h.palette.secondary.main,h.palette.info.main,h.palette.warning.main;const[k,P]=d.useState([]),[D,v]=d.useState(!0);d.useEffect(()=>{(async()=>{try{const u=sessionStorage.getItem("token");if(!u){alert("Token defeated, enter again"),g("/auth/login");return}const w=new Headers;w.append("authToken",u);const C={method:"GET",headers:w,redirect:"follow"},p=await(await fetch(`${Y.rutaApi}show_metrics_analytics_attrition`,C)).json();let i={Positive:0,Negative:0,Neutral:0,"No comment":0};p.forEach(o=>{if(o.calification)try{const s=o.calification.replace(/'/g,'"').replace(/([a-zA-Záéíóúñ]+):/g,'"$1":');let r=JSON.parse(s).Nivel;r==="Positivo"&&(r="Positive"),r==="Negativo"&&(r="Negative"),r==="Neutro"&&(r="Neutral"),r&&i.hasOwnProperty(r)?i[r]+=1:i["No comment"]+=1}catch{i["No comment"]+=1}else i["No comment"]+=1});const f=Object.values(i).reduce((o,s)=>o+s,0),n=Object.values(i).map(o=>f>0?parseFloat((o/f*100).toFixed(1)):0);P(n),v(!1)}catch(u){console.error(u),v(!1)}})()},[g]);const y=["Positive","Negative","Neutral","No comment"],_={labels:y,chart:{height:250,type:"donut",foreColor:"#adb0bb",fontFamily:"inherit",events:{dataPointSelection:(c,u,w)=>{const C=y[w.dataPointIndex];if(C){const j=C.toLowerCase().replace(" ","_");g(`/show_attrition_employee_customer/show_attrition_perspective?pers=${j}`)}}}},colors:["#589992","#C9ADCD","#8581B5","#255C82"],dataLabels:{enabled:!1},legend:{show:!1},stroke:{colors:["transparent"]},plotOptions:{pie:{donut:{size:"83",background:"transparent",labels:{show:!0,name:{show:!0,offsetY:7},value:{show:!1},total:{show:!0,color:"#a1aab2",fontSize:"13px",label:"Percentage %"}}}}},responsive:[{breakpoint:480,options:{chart:{height:230}}}],tooltip:{y:{formatter:function(c){return c.toFixed(1)+"%"}},theme:h.palette.mode==="dark"?"dark":"light",fillSeriesColor:!1}};return t.jsx(M,{title:"Job Satisfaction",subtitle:"",footer:t.jsxs(t.Fragment,{children:[t.jsx(ae,{}),t.jsx(q,{spacing:2,p:3,direction:"row",justifyContent:"center",flexWrap:"wrap",children:[{label:"Positive",color:"#589992"},{label:"Negative",color:"#C9ADCD"},{label:"Neutral",color:"#8581B5"},{label:"No comment",color:"#255C82"}].map((c,u)=>t.jsxs(q,{direction:"row",spacing:1,alignItems:"center",sx:{m:.5},children:[t.jsx(re,{sx:{width:9,height:9,bgcolor:c.color,svg:{display:"none"}}}),t.jsx(ee,{variant:"subtitle2",sx:{color:c.color},children:c.label})]},u))})]}),children:t.jsx(E,{height:"220px",children:t.jsx(d.Suspense,{fallback:t.jsx("div",{children:"Cargando gráfico..."}),children:!D&&k.length>0&&t.jsx(ie,{options:_,series:k,type:"donut",height:250,width:"100%"})})})})},le=V.lazy(()=>J(()=>import("./react-apexcharts.min-B794tETo.js").then(h=>h.r),__vite__mapDeps([0,1]))),de=()=>{const h=O(),[g,k]=d.useState([]),[P,D]=d.useState(!0);d.useEffect(()=>{(async()=>{try{const c=sessionStorage.getItem("token");if(!c){alert("Token defeated, enter again"),h("/auth/login");return}const u=new Headers;u.append("authToken",c);const w={method:"GET",headers:u,redirect:"follow"},j=await(await fetch(`${Y.rutaApi}show_metrics_analytics_attrition`,w)).json();let p=0,i=0,f=0;j.forEach(s=>{if(s.clasification){const a=s.clasification.toLowerCase();a.includes("high")?p++:a.includes("medium")?i++:a.includes("low")&&f++}});const n=p+i+f,o=[parseFloat((p/n*100).toFixed(1)),parseFloat((i/n*100).toFixed(1)),parseFloat((f/n*100).toFixed(1))];k(o),D(!1)}catch(c){console.error(c),D(!1)}})()},[h]);const v=_=>{h(`/show_attrition_employee_customer/show_risk?risk=${encodeURIComponent(_)}`)},y={chart:{type:"radar",toolbar:{show:!1},events:{markerClick:(_,c,u)=>{const C=["High","Medium","Low"][u.dataPointIndex];C&&v(C)}}},xaxis:{categories:["High Risk","Medium Risk","Low Risk"]},markers:{size:5,colors:["#255C82"]},stroke:{width:2,colors:["#255C82"]},fill:{opacity:.1,colors:["#255C82"]},yaxis:{show:!1},tooltip:{y:{formatter:_=>`${_}%`}}};return t.jsx(M,{title:"Attrition Risk",subtitle:"",children:t.jsx(q,{direction:"row",justifyContent:"center",children:t.jsx(E,{width:"400px",children:t.jsx(d.Suspense,{fallback:t.jsx("div",{children:"Cargando gráfico..."}),children:!P&&g.length>0&&t.jsx(le,{options:y,series:[{name:"Attrition Risk",data:g}],type:"radar",height:300})})})})})},he=V.lazy(()=>J(()=>import("./react-apexcharts.min-B794tETo.js").then(h=>h.r),__vite__mapDeps([0,1]))),ue=()=>{const[h,g]=d.useState(!0),[k,P]=d.useState([]),D=O(),v=K();v.palette.primary.main;const[y,_]=d.useState([]),[c,u]=d.useState([]);d.useEffect(()=>{(async()=>{try{const i=sessionStorage.getItem("token");if(!i){C("Token defeated, enter again","error"),g(!1),D("/auth/login");return}const f=new Headers;f.append("authToken",i);const n={method:"GET",headers:f,redirect:"follow"},s=await(await fetch(`${Y.rutaApi}show_metrics_analytics_attrition`,n)).json(),a={};s.forEach(m=>{const l=m.customer||"Unknown Client",b=m.clasification;a[l]||(a[l]={Low:0,Mid:0,High:0}),b.includes("Low")?a[l].Low+=1:b.includes("Medium")?a[l].Mid+=1:b.includes("High")&&(a[l].High+=1)});const r=Object.entries(a).sort((m,l)=>{const b=m[1].Low+m[1].Mid+m[1].High;return l[1].Low+l[1].Mid+l[1].High-b}),F=r.map(([m])=>m),A=r.map(([m,l])=>l.Low),I=r.map(([m,l])=>l.Mid),S=r.map(([m,l])=>l.High);_(F),u([{name:"Low Risk",data:A},{name:"Medium Risk",data:I},{name:"High Risk",data:S}]),g(!1)}catch(i){console.error("Error fetching data:",i),g(!1)}})()},[]);const w=(p,i)=>{D(`/show_attrition_employee_customer/show_attrition_employee_customer?cliente=${encodeURIComponent(p)}&riesgo=${encodeURIComponent(i)}`)},C=(p,i)=>{P(f=>[...f,{msg:p,severity:i}])},j={chart:{type:"bar",stacked:!0,foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},events:{dataPointSelection:function(p,i,f){const n=y[f.dataPointIndex],o=c[f.seriesIndex].name;w(n,o)}}},plotOptions:{bar:{horizontal:!0,borderRadius:4,barHeight:"60%"}},xaxis:{categories:y},legend:{position:"top"},fill:{opacity:1},colors:[v.palette.success.main,v.palette.warning.main,v.palette.error.main],tooltip:{y:{formatter:p=>`${p} empleados`}}};return t.jsx(t.Fragment,{children:t.jsx(M,{title:"Risk per client",subtitle:"",children:t.jsx(E,{height:"400px",children:t.jsx(he,{options:j,series:c,type:"bar",height:400,width:"100%"})})})})};function Ie(){return O(),t.jsx(E,{children:t.jsxs($,{container:!0,spacing:3,children:[t.jsx($,{size:{xs:12,lg:8},children:t.jsx(ne,{})}),t.jsx($,{size:{xs:12,lg:4},children:t.jsx(ce,{})}),t.jsx($,{size:{xs:12,lg:4},children:t.jsx(de,{})}),t.jsx($,{size:{xs:12,lg:8},children:t.jsx(ue,{})})]})})}export{Ie as default};
