const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-apexcharts.min-DeuA7I_r.js","assets/index-BxHjN_14.js"])))=>i.map(i=>d[i]);
import{r as h,i as M,j as t,R as q,_ as J}from"./index-BxHjN_14.js";import{C as he}from"./react-apexcharts.min-DeuA7I_r.js";import{D as U}from"./DashboardCard-BEhWhB0m.js";import{c as G}from"./config-BwmyTBcy.js";import{u as Z}from"./Paper-Dc6Wg0Kl.js";import{B as F,T as X}from"./Box-DqDrr6YK.js";import{D as ue}from"./Divider-BqZB1UZj.js";import{S as W}from"./Stack-Dg58dZxH.js";import{A as fe}from"./Avatar-BzAIpD2V.js";import{G as B}from"./Grid2-DLUZDnDU.js";import"./Card-CY2WmlRJ.js";import"./CardContent-BEvJwpBT.js";import"./useThemeProps-hBiosjmp.js";import"./createSvgIcon-LNInKgTq.js";import"./useSlot-DbUxneSh.js";import"./resolveComponentProps-C1vTgv-F.js";import"./useForkRef-DXUt_G2j.js";import"./isMuiElement-BUzYMHMY.js";const me=()=>{const[u,m]=h.useState(!0),[j,N]=h.useState([]),[D,v]=h.useState([]),[w,C]=h.useState([]),l=M(),f=Z();f.palette.primary.main,f.palette.secondary.main,h.useEffect(()=>{(async()=>{try{const r=sessionStorage.getItem("token");if(!r){m(!1),l("/auth/login");return}const s=new Headers;s.append("authToken",r);const i=await fetch(`${G.rutaApi}employee_system_list`,{method:"GET",headers:s});if(i.status===401){sessionStorage.removeItem("token"),alert("Sesión expirada, por favor ingresa nuevamente"),l("/auth/login");return}const n=await i.json();C(n.dataEmployees||[]),m(!1)}catch(r){console.error("Error fetching data:",r),m(!1)}})()},[l]),h.useEffect(()=>{w.length>0&&y()},[w]);const x=(o,r)=>{for(const s of r){const i=o[s];if(!i)continue;const n=new Date(i);if(!isNaN(n.getTime()))return n}return null},y=()=>{const o=new Date,r=o.getFullYear(),s=r-1,i=s-1,n=Array.from(new Set(w.map(e=>e.customer||"Unknown Client"))),d=["start_date","hire_date","created_at","active_since","fecha_ingreso"],T=["active_until","end_date","terminacion_date","fecha_salida"],I=(e,c)=>(e==null?void 0:e.id)??(e==null?void 0:e.employee_id)??(e==null?void 0:e.document_number)??`${(e==null?void 0:e.email)??""}__${c}`,k=(e,c)=>{const R=new Set;let _=0;return e.forEach((S,H)=>{const E=I(S,H);if(R.has(E))return;const L=x(S,d),O=x(S,T),$=!L||L.getTime()<=c.getTime(),z=O&&O.getTime()<=c.getTime();$&&!z&&(_++,R.add(E))}),_},g=(e,c)=>{const R=new Set;return e.forEach((_,S)=>{const H=I(_,S),E=x(_,T);E&&E.getFullYear()===c&&R.add(H)}),R.size},P=e=>new Date(e,11,31,23,59,59,999),b=n.map(e=>{const c=w.filter(Y=>(Y.customer||"Unknown Client")===e),R=k(c,P(i)),_=k(c,P(s)),S=k(c,o),H=g(c,s),E=g(c,r),L=(Y,Q)=>{if(Q>0){const le=Y/Q*100,de=Math.min(le,100);return parseFloat(de.toFixed(1))}else return Y>0?100:0},O=(_+S)/2,$=(R+_)/2,z=L(E,O),V=L(H,$),K=.1,ie=z>0?z:K,ce=V>0?V:K;return{customer:e,prevReal:V,currReal:z,prevPlot:ce,currPlot:ie}});b.sort((e,c)=>{const R=e.currReal===100||e.prevReal===100,_=c.currReal===100||c.prevReal===100,S=e.currReal===0&&e.prevReal===0,H=c.currReal===0&&c.prevReal===0,E=e.currReal>0&&e.prevReal>0,L=c.currReal>0&&c.prevReal>0,O=E&&!R?0:R?1:S?2:1,$=L&&!_?0:_?1:H?2:1;return O!==$?O-$:c.currReal-e.currReal||c.prevReal-e.prevReal||e.customer.localeCompare(c.customer)});const ee=b.map(e=>e.customer),te="#EDD9ED",oe="#CD9ACD",re=b.map(e=>e.prevReal),se=b.map(e=>e.currReal),ae=b.map(e=>({x:e.customer,y:e.prevPlot,real:e.prevReal,fillColor:e.prevReal===0?"rgba(0,0,0,0)":te})),ne=b.map(e=>({x:e.customer,y:e.currPlot,real:e.currReal,fillColor:e.currReal===0?"rgba(0,0,0,0)":oe}));N(ee),v([{name:`${s}`,data:ae,_real:re},{name:`${r}`,data:ne,_real:se}])},A={chart:{foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},zoom:{enabled:!1},events:{dataPointSelection:(o,r,s)=>{const i=j[s.dataPointIndex];i&&l(`/profiles/customerProfile?nameCustomer=${encodeURIComponent(i)}`)}}},colors:["#EDD9ED","#CD9ACD"],plotOptions:{bar:{horizontal:!1,borderRadius:6,columnWidth:"60%"}},grid:{show:!0,strokeDashArray:3,borderColor:"rgba(0,0,0,.08)"},xaxis:{categories:j,labels:{rotate:-30,rotateAlways:!0,style:{fontSize:"13px"}},axisTicks:{show:!1},axisBorder:{show:!1}},stroke:{show:!0,width:2,colors:["transparent"]},dataLabels:{enabled:!1},tooltip:{y:{formatter:(o,r)=>{var s,i,n,d,T,I;try{const k=(T=(d=(n=(i=(s=r==null?void 0:r.w)==null?void 0:s.config)==null?void 0:i.series)==null?void 0:n[r.seriesIndex])==null?void 0:d.data)==null?void 0:T[r.dataPointIndex],g=typeof(k==null?void 0:k.real)=="number"?k.real:void 0;return`${Number(typeof g=="number"?g:o).toFixed(1)}%`}catch{return`${((I=o.toFixed)==null?void 0:I.call(o,1))??o}%`}}}},legend:{position:"top"}},a=Math.max(j.length*120,600);return t.jsx(U,{title:"Historic Attrition Risk",children:t.jsx(F,{sx:{height:360,width:"100%",display:"flex",flexDirection:"column"},children:u?t.jsx(F,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(X,{variant:"body2",children:"Cargando..."})}):t.jsx(F,{sx:{overflowX:"auto",px:1,py:.5},children:t.jsx(F,{sx:{width:a,minHeight:280},children:t.jsx(he,{options:A,series:D,type:"bar",height:280,width:a})})})})})},pe=q.lazy(()=>J(()=>import("./react-apexcharts.min-DeuA7I_r.js").then(u=>u.r),__vite__mapDeps([0,1]))),ge=()=>{const u=Z(),m=M();u.palette.primary.main,u.palette.secondary.main,u.palette.info.main,u.palette.warning.main;const[j,N]=h.useState([]),[D,v]=h.useState(!0);h.useEffect(()=>{(async()=>{try{const f=sessionStorage.getItem("token");if(!f){alert("Token defeated, enter again"),m("/auth/login");return}const x=new Headers;x.append("authToken",f);const y={method:"GET",headers:x,redirect:"follow"},p=await(await fetch(`${G.rutaApi}show_metrics_analytics_attrition`,y)).json();let a={Positive:0,Negative:0,Neutral:0,"No comment":0};p.forEach(s=>{if(s.calification)try{const i=s.calification.replace(/'/g,'"').replace(/([a-zA-Záéíóúñ]+):/g,'"$1":');let d=JSON.parse(i).Nivel;d==="Positivo"&&(d="Positive"),d==="Negativo"&&(d="Negative"),d==="Neutro"&&(d="Neutral"),d&&a.hasOwnProperty(d)?a[d]+=1:a["No comment"]+=1}catch{a["No comment"]+=1}else a["No comment"]+=1});const o=Object.values(a).reduce((s,i)=>s+i,0),r=Object.values(a).map(s=>o>0?parseFloat((s/o*100).toFixed(1)):0);N(r),v(!1)}catch(f){console.error(f),v(!1)}})()},[m]);const w=["Positive","Negative","Neutral","No comment"],C={labels:w,chart:{height:250,type:"donut",foreColor:"#adb0bb",fontFamily:"inherit",events:{dataPointSelection:(l,f,x)=>{const y=w[x.dataPointIndex];if(y){const A=y.toLowerCase().replace(" ","_");m(`/show_attrition_employee_customer/show_attrition_perspective?pers=${A}`)}}}},colors:["#589992","#C9ADCD","#8581B5","#255C82"],dataLabels:{enabled:!1},legend:{show:!1},stroke:{colors:["transparent"]},plotOptions:{pie:{donut:{size:"83",background:"transparent",labels:{show:!0,name:{show:!0,offsetY:7},value:{show:!1},total:{show:!0,color:"#a1aab2",fontSize:"13px",label:"Percentage %"}}}}},responsive:[{breakpoint:480,options:{chart:{height:230}}}],tooltip:{y:{formatter:function(l){return l.toFixed(1)+"%"}},theme:u.palette.mode==="dark"?"dark":"light",fillSeriesColor:!1}};return t.jsx(U,{title:"Job Satisfaction",subtitle:"",footer:t.jsxs(t.Fragment,{children:[t.jsx(ue,{}),t.jsx(W,{spacing:2,p:3,direction:"row",justifyContent:"center",flexWrap:"wrap",children:[{label:"Positive",color:"#589992"},{label:"Negative",color:"#C9ADCD"},{label:"Neutral",color:"#8581B5"},{label:"No comment",color:"#255C82"}].map((l,f)=>t.jsxs(W,{direction:"row",spacing:1,alignItems:"center",sx:{m:.5},children:[t.jsx(fe,{sx:{width:9,height:9,bgcolor:l.color,svg:{display:"none"}}}),t.jsx(X,{variant:"subtitle2",sx:{color:l.color},children:l.label})]},f))})]}),children:t.jsx(F,{height:"220px",children:t.jsx(h.Suspense,{fallback:t.jsx("div",{children:"Cargando gráfico..."}),children:!D&&j.length>0&&t.jsx(pe,{options:C,series:j,type:"donut",height:250,width:"100%"})})})})},xe=q.lazy(()=>J(()=>import("./react-apexcharts.min-DeuA7I_r.js").then(u=>u.r),__vite__mapDeps([0,1]))),we=()=>{const u=M(),[m,j]=h.useState([]),[N,D]=h.useState(!0);h.useEffect(()=>{(async()=>{try{const l=sessionStorage.getItem("token");if(!l){alert("Token defeated, enter again"),u("/auth/login");return}const f=new Headers;f.append("authToken",l);const x={method:"GET",headers:f,redirect:"follow"},A=await(await fetch(`${G.rutaApi}show_metrics_analytics_attrition`,x)).json();let p=0,a=0,o=0;A.forEach(i=>{if(i.clasification){const n=i.clasification.toLowerCase();n.includes("high")?p++:n.includes("medium")?a++:n.includes("low")&&o++}});const r=p+a+o,s=[parseFloat((p/r*100).toFixed(1)),parseFloat((a/r*100).toFixed(1)),parseFloat((o/r*100).toFixed(1))];j(s),D(!1)}catch(l){console.error(l),D(!1)}})()},[u]);const v=C=>{u(`/show_attrition_employee_customer/show_risk?risk=${encodeURIComponent(C)}`)},w={chart:{type:"radar",toolbar:{show:!1},events:{markerClick:(C,l,f)=>{const y=["High","Medium","Low"][f.dataPointIndex];y&&v(y)}}},xaxis:{categories:["High Risk","Medium Risk","Low Risk"]},markers:{size:5,colors:["#255C82"]},stroke:{width:2,colors:["#255C82"]},fill:{opacity:.1,colors:["#255C82"]},yaxis:{show:!1},tooltip:{y:{formatter:C=>`${C}%`}}};return t.jsx(U,{title:"Attrition Risk",subtitle:"",children:t.jsx(W,{direction:"row",justifyContent:"center",children:t.jsx(F,{width:"400px",children:t.jsx(h.Suspense,{fallback:t.jsx("div",{children:"Cargando gráfico..."}),children:!N&&m.length>0&&t.jsx(xe,{options:w,series:[{name:"Attrition Risk",data:m}],type:"radar",height:300})})})})})},ye=q.lazy(()=>J(()=>import("./react-apexcharts.min-DeuA7I_r.js").then(u=>u.r),__vite__mapDeps([0,1]))),ve=()=>{const[u,m]=h.useState(!0),[j,N]=h.useState([]),D=M(),v=Z();v.palette.primary.main;const[w,C]=h.useState([]),[l,f]=h.useState([]);h.useEffect(()=>{(async()=>{try{const a=sessionStorage.getItem("token");if(!a){y("Token defeated, enter again","error"),m(!1),D("/auth/login");return}const o=new Headers;o.append("authToken",a);const r={method:"GET",headers:o,redirect:"follow"},i=await(await fetch(`${G.rutaApi}show_metrics_analytics_attrition`,r)).json(),n={};i.forEach(g=>{const P=g.customer||"Unknown Client",b=g.clasification;n[P]||(n[P]={Low:0,Mid:0,High:0}),b.includes("Low")?n[P].Low+=1:b.includes("Medium")?n[P].Mid+=1:b.includes("High")&&(n[P].High+=1)});const d=Object.keys(n),T=d.map(g=>n[g].Low),I=d.map(g=>n[g].Mid),k=d.map(g=>n[g].High);C(d),f([{name:"Low Risk",data:T},{name:"Medium Risk",data:I},{name:"High Risk",data:k}]),m(!1)}catch(a){console.error("Error fetching data:",a),m(!1)}})()},[]);const x=(p,a)=>{D(`/show_attrition_employee_customer/show_attrition_employee_customer?cliente=${encodeURIComponent(p)}&riesgo=${encodeURIComponent(a)}`)},y=(p,a)=>{N(o=>[...o,{msg:p,severity:a}])},A={chart:{type:"bar",stacked:!0,foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},events:{dataPointSelection:function(p,a,o){const r=w[o.dataPointIndex],s=l[o.seriesIndex].name;x(r,s)}}},plotOptions:{bar:{horizontal:!0,borderRadius:4,barHeight:"60%"}},xaxis:{categories:w},legend:{position:"top"},fill:{opacity:1},colors:[v.palette.success.main,v.palette.warning.main,v.palette.error.main],tooltip:{y:{formatter:p=>`${p} empleados`}}};return t.jsx(t.Fragment,{children:t.jsx(U,{title:"Risk per client",subtitle:"",children:t.jsx(F,{height:"400px",children:t.jsx(ye,{options:A,series:l,type:"bar",height:400,width:"100%"})})})})};function $e(){return M(),t.jsx(F,{children:t.jsxs(B,{container:!0,spacing:3,children:[t.jsx(B,{size:{xs:12,lg:8},children:t.jsx(me,{})}),t.jsx(B,{size:{xs:12,lg:4},children:t.jsx(ge,{})}),t.jsx(B,{size:{xs:12,lg:4},children:t.jsx(we,{})}),t.jsx(B,{size:{xs:12,lg:8},children:t.jsx(ve,{})})]})})}export{$e as default};
