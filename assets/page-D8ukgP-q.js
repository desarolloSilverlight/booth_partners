const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-apexcharts.min-CnZU9KHZ.js","assets/index-CJU5MQjK.js"])))=>i.map(i=>d[i]);
import{r as l,i as H,j as t,R as V,_ as J}from"./index-CJU5MQjK.js";import{C as se}from"./react-apexcharts.min-CnZU9KHZ.js";import{D as M}from"./DashboardCard-DHOSiepd.js";import{c as Y}from"./config-BwmyTBcy.js";import{u as K}from"./Paper-DuLtMsh8.js";import{B as S,T as ee}from"./Box-n9iJj8RL.js";import{D as ae}from"./Divider-CQ3OK35Z.js";import{S as q}from"./Stack-gaJ9mtYc.js";import{A as re}from"./Avatar-44-YiT-y.js";import{G as $}from"./Grid2-BMa726Jv.js";import"./Card-Ct6aUZJP.js";import"./CardContent-Dv7cKb8W.js";import"./useThemeProps-DLxooYuZ.js";import"./createSvgIcon-Cr6Zc33o.js";import"./useSlot-xazagwgq.js";import"./resolveComponentProps-DPIZlf2G.js";import"./useForkRef-B6FfdXhL.js";import"./isMuiElement-DjPusY45.js";const ne=()=>{const[d,p]=l.useState(!0),[k,R]=l.useState([]),[_,v]=l.useState([]),[w,C]=l.useState([]),c=H(),h=K();h.palette.primary.main,h.palette.secondary.main,l.useEffect(()=>{(async()=>{try{const o=sessionStorage.getItem("token");if(!o){p(!1),c("/auth/login");return}const a=new Headers;a.append("authToken",o);const s=await fetch(`${Y.rutaApi}employee_system_list`,{method:"GET",headers:a});if(s.status===401){sessionStorage.removeItem("token"),alert("Sesión expirada, por favor ingresa nuevamente"),c("/auth/login");return}const r=await s.json();C(r.dataEmployees||[]),p(!1)}catch(o){console.error("Error fetching data:",o),p(!1)}})()},[c]),l.useEffect(()=>{w.length>0&&D()},[w]);const x=(n,o)=>{for(const a of o){const s=n[a];if(!s)continue;const r=new Date(s);if(!isNaN(r.getTime()))return r}return null},y=n=>{const o=new Date,a=o.getFullYear();return n===a?o:new Date(n,11,31,23,59,59,999)},D=()=>{const o=new Date().getFullYear(),a=o-1,s=Array.from(new Set(w.map(e=>e.customer||"Unknown Client"))),r=["start_date","hire_date","created_at","active_since","fecha_ingreso"],E=["active_until","end_date","terminacion_date","fecha_salida"],P=(e,g)=>(e==null?void 0:e.id)??(e==null?void 0:e.employee_id)??(e==null?void 0:e.document_number)??`${(e==null?void 0:e.email)??""}__${g}`,F=e=>new Date(e,0,1,0,0,0,0),m=e=>new Date(e,11,31,23,59,59,999),b=(e,g)=>{const T=new Set;return e.forEach((j,A)=>{const L=P(j,A),N=x(j,E);N&&N.getFullYear()===g&&T.add(L)}),T.size},I=(e,g,T)=>{const j=new Set;return e.forEach((A,L)=>{const N=P(A,L);if(j.has(N))return;const U=x(A,r)??new Date(-864e13),B=x(A,E)??new Date(864e13);U.getTime()<=T.getTime()&&B.getTime()>=g.getTime()&&j.add(N)}),j.size},O=s.map(e=>{const g=w.filter(z=>(z.customer||"Unknown Client")===e),T=F(a),j=m(a),A=F(o),L=y(o),N=b(g,a),U=b(g,o),B=I(g,T,j),te=I(g,A,L),Q=(z,Z)=>{if(Z>0){const oe=z/Z*100;return parseFloat(Math.min(oe,100).toFixed(1))}else return z>0?100:0},G=Q(N,B),W=Q(U,te),X=.1;return{customer:e,prevReal:G,currReal:W,prevPlot:G>0?G:X,currPlot:W>0?W:X,basePrev:"#EDD9ED",baseCurr:"#CD9ACD"}});O.sort((e,g)=>g.currReal-e.currReal||g.prevReal-e.prevReal||e.customer.localeCompare(g.customer)),R(O.map(e=>e.customer)),v([{name:`${a}`,data:O.map(e=>({x:e.customer,y:e.prevPlot,real:e.prevReal,fillColor:e.basePrev}))},{name:`${o}`,data:O.map(e=>({x:e.customer,y:e.currPlot,real:e.currReal,fillColor:e.baseCurr}))}])},f={chart:{foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},zoom:{enabled:!1},events:{dataPointSelection:(n,o,a)=>{const s=k[a.dataPointIndex];s&&c(`/profiles/customerProfile?nameCustomer=${encodeURIComponent(s)}`)}}},colors:["#EDD9ED","#CD9ACD"],plotOptions:{bar:{horizontal:!1,borderRadius:6,columnWidth:"60%"}},grid:{show:!0,strokeDashArray:3,borderColor:"rgba(0,0,0,.08)"},xaxis:{categories:k,labels:{rotate:-30,rotateAlways:!0,style:{fontSize:"13px"}},axisTicks:{show:!1},axisBorder:{show:!1}},stroke:{show:!0,width:2,colors:["transparent"]},dataLabels:{enabled:!1},tooltip:{y:{formatter:(n,o)=>{var a,s,r,E,P,F;try{const m=(P=(E=(r=(s=(a=o==null?void 0:o.w)==null?void 0:a.config)==null?void 0:s.series)==null?void 0:r[o.seriesIndex])==null?void 0:E.data)==null?void 0:P[o.dataPointIndex],b=typeof(m==null?void 0:m.real)=="number"?m.real:void 0;return`${Number(typeof b=="number"?b:n).toFixed(1)}%`}catch{return`${((F=n.toFixed)==null?void 0:F.call(n,1))??n}%`}}}},legend:{position:"top"}},u=Math.max(k.length*120,600);return t.jsx(M,{title:"Historic Attrition Risk",children:t.jsx(S,{sx:{height:360,width:"100%",display:"flex",flexDirection:"column"},children:d?t.jsx(S,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(ee,{variant:"body2",children:"Cargando..."})}):t.jsx(S,{sx:{overflowX:"auto",px:1,py:.5},children:t.jsx(S,{sx:{width:u,minHeight:280},children:t.jsx(se,{options:f,series:_,type:"bar",height:280,width:u})})})})})},ie=V.lazy(()=>J(()=>import("./react-apexcharts.min-CnZU9KHZ.js").then(d=>d.r),__vite__mapDeps([0,1]))),ce=()=>{const d=K(),p=H();d.palette.primary.main,d.palette.secondary.main,d.palette.info.main,d.palette.warning.main;const[k,R]=l.useState([]),[_,v]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const h=sessionStorage.getItem("token");if(!h){alert("Token defeated, enter again"),p("/auth/login");return}const x=new Headers;x.append("authToken",h);const y={method:"GET",headers:x,redirect:"follow"},f=await(await fetch(`${Y.rutaApi}show_metrics_analytics_attrition`,y)).json();let i={Positive:0,Negative:0,Neutral:0,"No comment":0};f.forEach(o=>{if(o.calification)try{const a=o.calification.replace(/'/g,'"').replace(/([a-zA-Záéíóúñ]+):/g,'"$1":');let r=JSON.parse(a).Nivel;r==="Positivo"&&(r="Positive"),r==="Negativo"&&(r="Negative"),r==="Neutro"&&(r="Neutral"),r&&i.hasOwnProperty(r)?i[r]+=1:i["No comment"]+=1}catch{i["No comment"]+=1}else i["No comment"]+=1});const u=Object.values(i).reduce((o,a)=>o+a,0),n=Object.values(i).map(o=>u>0?parseFloat((o/u*100).toFixed(1)):0);R(n),v(!1)}catch(h){console.error(h),v(!1)}})()},[p]);const w=["Positive","Negative","Neutral","No comment"],C={labels:w,chart:{height:250,type:"donut",foreColor:"#adb0bb",fontFamily:"inherit",events:{dataPointSelection:(c,h,x)=>{const y=w[x.dataPointIndex];if(y){const D=y.toLowerCase().replace(" ","_");p(`/show_attrition_employee_customer/show_attrition_perspective?pers=${D}`)}}}},colors:["#589992","#C9ADCD","#8581B5","#255C82"],dataLabels:{enabled:!1},legend:{show:!1},stroke:{colors:["transparent"]},plotOptions:{pie:{donut:{size:"83",background:"transparent",labels:{show:!0,name:{show:!0,offsetY:7},value:{show:!1},total:{show:!0,color:"#a1aab2",fontSize:"13px",label:"Percentage %"}}}}},responsive:[{breakpoint:480,options:{chart:{height:230}}}],tooltip:{y:{formatter:function(c){return c.toFixed(1)+"%"}},theme:d.palette.mode==="dark"?"dark":"light",fillSeriesColor:!1}};return t.jsx(M,{title:"Job Satisfaction",subtitle:"",footer:t.jsxs(t.Fragment,{children:[t.jsx(ae,{}),t.jsx(q,{spacing:2,p:3,direction:"row",justifyContent:"center",flexWrap:"wrap",children:[{label:"Positive",color:"#589992"},{label:"Negative",color:"#C9ADCD"},{label:"Neutral",color:"#8581B5"},{label:"No comment",color:"#255C82"}].map((c,h)=>t.jsxs(q,{direction:"row",spacing:1,alignItems:"center",sx:{m:.5},children:[t.jsx(re,{sx:{width:9,height:9,bgcolor:c.color,svg:{display:"none"}}}),t.jsx(ee,{variant:"subtitle2",sx:{color:c.color},children:c.label})]},h))})]}),children:t.jsx(S,{height:"220px",children:t.jsx(l.Suspense,{fallback:t.jsx("div",{children:"Cargando gráfico..."}),children:!_&&k.length>0&&t.jsx(ie,{options:C,series:k,type:"donut",height:250,width:"100%"})})})})},le=V.lazy(()=>J(()=>import("./react-apexcharts.min-CnZU9KHZ.js").then(d=>d.r),__vite__mapDeps([0,1]))),de=()=>{const d=H(),[p,k]=l.useState([]),[R,_]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const c=sessionStorage.getItem("token");if(!c){alert("Token defeated, enter again"),d("/auth/login");return}const h=new Headers;h.append("authToken",c);const x={method:"GET",headers:h,redirect:"follow"},D=await(await fetch(`${Y.rutaApi}show_metrics_analytics_attrition`,x)).json();let f=0,i=0,u=0;D.forEach(a=>{if(a.clasification){const s=a.clasification.toLowerCase();s.includes("high")?f++:s.includes("medium")?i++:s.includes("low")&&u++}});const n=f+i+u,o=[parseFloat((f/n*100).toFixed(1)),parseFloat((i/n*100).toFixed(1)),parseFloat((u/n*100).toFixed(1))];k(o),_(!1)}catch(c){console.error(c),_(!1)}})()},[d]);const v=C=>{d(`/show_attrition_employee_customer/show_risk?risk=${encodeURIComponent(C)}`)},w={chart:{type:"radar",toolbar:{show:!1},events:{markerClick:(C,c,h)=>{const y=["High","Medium","Low"][h.dataPointIndex];y&&v(y)}}},xaxis:{categories:["High Risk","Medium Risk","Low Risk"]},markers:{size:5,colors:["#255C82"]},stroke:{width:2,colors:["#255C82"]},fill:{opacity:.1,colors:["#255C82"]},yaxis:{show:!1},tooltip:{y:{formatter:C=>`${C}%`}}};return t.jsx(M,{title:"Attrition Risk",subtitle:"",children:t.jsx(q,{direction:"row",justifyContent:"center",children:t.jsx(S,{width:"400px",children:t.jsx(l.Suspense,{fallback:t.jsx("div",{children:"Cargando gráfico..."}),children:!R&&p.length>0&&t.jsx(le,{options:w,series:[{name:"Attrition Risk",data:p}],type:"radar",height:300})})})})})},he=V.lazy(()=>J(()=>import("./react-apexcharts.min-CnZU9KHZ.js").then(d=>d.r),__vite__mapDeps([0,1]))),ue=()=>{const[d,p]=l.useState(!0),[k,R]=l.useState([]),_=H(),v=K();v.palette.primary.main;const[w,C]=l.useState([]),[c,h]=l.useState([]);l.useEffect(()=>{(async()=>{try{const i=sessionStorage.getItem("token");if(!i){y("Token defeated, enter again","error"),p(!1),_("/auth/login");return}const u=new Headers;u.append("authToken",i);const n={method:"GET",headers:u,redirect:"follow"},a=await(await fetch(`${Y.rutaApi}show_metrics_analytics_attrition`,n)).json(),s={};a.forEach(m=>{const b=m.customer||"Unknown Client",I=m.clasification;s[b]||(s[b]={Low:0,Mid:0,High:0}),I.includes("Low")?s[b].Low+=1:I.includes("Medium")?s[b].Mid+=1:I.includes("High")&&(s[b].High+=1)});const r=Object.keys(s),E=r.map(m=>s[m].Low),P=r.map(m=>s[m].Mid),F=r.map(m=>s[m].High);C(r),h([{name:"Low Risk",data:E},{name:"Medium Risk",data:P},{name:"High Risk",data:F}]),p(!1)}catch(i){console.error("Error fetching data:",i),p(!1)}})()},[]);const x=(f,i)=>{_(`/show_attrition_employee_customer/show_attrition_employee_customer?cliente=${encodeURIComponent(f)}&riesgo=${encodeURIComponent(i)}`)},y=(f,i)=>{R(u=>[...u,{msg:f,severity:i}])},D={chart:{type:"bar",stacked:!0,foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},events:{dataPointSelection:function(f,i,u){const n=w[u.dataPointIndex],o=c[u.seriesIndex].name;x(n,o)}}},plotOptions:{bar:{horizontal:!0,borderRadius:4,barHeight:"60%"}},xaxis:{categories:w},legend:{position:"top"},fill:{opacity:1},colors:[v.palette.success.main,v.palette.warning.main,v.palette.error.main],tooltip:{y:{formatter:f=>`${f} empleados`}}};return t.jsx(t.Fragment,{children:t.jsx(M,{title:"Risk per client",subtitle:"",children:t.jsx(S,{height:"400px",children:t.jsx(he,{options:D,series:c,type:"bar",height:400,width:"100%"})})})})};function Ae(){return H(),t.jsx(S,{children:t.jsxs($,{container:!0,spacing:3,children:[t.jsx($,{size:{xs:12,lg:8},children:t.jsx(ne,{})}),t.jsx($,{size:{xs:12,lg:4},children:t.jsx(ce,{})}),t.jsx($,{size:{xs:12,lg:4},children:t.jsx(de,{})}),t.jsx($,{size:{xs:12,lg:8},children:t.jsx(ue,{})})]})})}export{Ae as default};
