const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-apexcharts.min-DM8zd8sA.js","assets/index-DArN1dFc.js"])))=>i.map(i=>d[i]);
import{r as l,i as N,j as e,R as J,_ as V}from"./index-DArN1dFc.js";import{C as re}from"./react-apexcharts.min-DM8zd8sA.js";import{D as z}from"./DashboardCard-DnsiC2X-.js";import{c as M}from"./config-BwmyTBcy.js";import{u as W}from"./Paper-B5KoSjAN.js";import{B as D,T as Z}from"./Box-BHYhwnxN.js";import{D as ne}from"./Divider-BLx_cDjH.js";import{S as Y}from"./Stack-Bcx7CXcQ.js";import{A as ie}from"./Avatar-y_QiOEPJ.js";import{G as F}from"./Grid2-B9I1eQEN.js";import"./Card-Du0Kn1VK.js";import"./CardContent-C1faP2Cf.js";import"./useThemeProps-DiEwoLm-.js";import"./createSvgIcon-D7lE_Aax.js";import"./useSlot-CM4vz_9Z.js";import"./resolveComponentProps-B-_MkBH8.js";import"./useForkRef-X5pKffJm.js";import"./isMuiElement-2WvzZlkK.js";const ce=()=>{const[d,f]=l.useState(!0),[_,S]=l.useState([]),[k,v]=l.useState([]),[w,C]=l.useState([]),i=N(),h=W();h.palette.primary.main,h.palette.secondary.main,l.useEffect(()=>{(async()=>{try{const r=sessionStorage.getItem("token");if(!r){f(!1),i("/auth/login");return}const a=new Headers;a.append("authToken",r);const c=await fetch(`${M.rutaApi}employee_system_list`,{method:"GET",headers:a});if(c.status===401){sessionStorage.removeItem("token"),alert("Sesión expirada, por favor ingresa nuevamente"),i("/auth/login");return}const n=await c.json();C(n.dataEmployees||[]),f(!1)}catch(r){console.error("Error fetching data:",r),f(!1)}})()},[i]),l.useEffect(()=>{w.length>0&&y()},[w]);const p=(s,r)=>{for(const a of r){const c=s[a];if(!c)continue;const n=new Date(c);if(!isNaN(n.getTime()))return n}return null},y=()=>{const s=new Date,r=s.getFullYear(),a=r-1,c=Array.from(new Set(w.map(o=>o.customer||"Unknown Client"))).sort(),n=[],u=[],B=["start_date","hire_date","created_at","active_since","fecha_ingreso"],L=["active_until","end_date","terminacion_date","fecha_salida"],I=(o,x)=>(o==null?void 0:o.id)??(o==null?void 0:o.employee_id)??(o==null?void 0:o.document_number)??`${(o==null?void 0:o.email)??""}__${x}`,g=(o,x)=>{const E=new Set;let P=0;return o.forEach((R,T)=>{const A=I(R,T);if(E.has(A))return;const O=p(R,B),$=p(R,L),U=!O||O.getTime()<=x.getTime(),G=$&&$.getTime()<=x.getTime();U&&!G&&(P++,E.add(A))}),P},j=(o,x)=>{const E=new Set;return o.forEach((P,R)=>{const T=I(P,R),A=p(P,L);A&&A.getFullYear()===x&&E.add(T)}),E.size};for(const o of c){const x=w.filter(H=>(H.customer||"Unknown Client")===o),E=new Date(a,0,1),P=new Date(a,11,31,23,59,59,999),R=new Date(r,0,1),T=s,A=g(x,E),O=g(x,P),$=g(x,R),U=g(x,T),G=j(x,a),ee=j(x,r),te=(A+O)/2,oe=($+U)/2,q=(H,X)=>{if(X>0){const se=H/X*100,ae=Math.min(se,100);return parseFloat(ae.toFixed(1))}else return H>0?100:0},K=q(G,te),Q=q(ee,oe);n.push(K>0?K:.1),u.push(Q>0?Q:.1)}S(c),v([{name:`${a}`,data:n},{name:`${r}`,data:u}])},b={chart:{foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},zoom:{enabled:!1},events:{dataPointSelection:(s,r,a)=>{const c=_[a.dataPointIndex];c&&i(`/profiles/customerProfile?nameCustomer=${encodeURIComponent(c)}`)}}},colors:["#EDD9ED","#CD9ACD"],plotOptions:{bar:{horizontal:!1,borderRadius:6,columnWidth:"60%"}},grid:{show:!0,strokeDashArray:3,borderColor:"rgba(0,0,0,.08)"},xaxis:{categories:_,labels:{rotate:-30,rotateAlways:!0,style:{fontSize:"13px"}},axisTicks:{show:!1},axisBorder:{show:!1}},stroke:{show:!0,width:2,colors:["transparent"]},dataLabels:{enabled:!1},tooltip:{y:{formatter:s=>`${s}%`}},legend:{position:"top"}},t=Math.max(_.length*120,600);return e.jsx(z,{title:"Historic Attrition Risk",children:e.jsx(D,{sx:{height:360,width:"100%",display:"flex",flexDirection:"column"},children:d?e.jsx(D,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{variant:"body2",children:"Cargando..."})}):e.jsx(D,{sx:{overflowX:"auto",px:1,py:.5},children:e.jsx(D,{sx:{width:t,minHeight:280},children:e.jsx(re,{options:b,series:k,type:"bar",height:280,width:t})})})})})},le=J.lazy(()=>V(()=>import("./react-apexcharts.min-DM8zd8sA.js").then(d=>d.r),__vite__mapDeps([0,1]))),de=()=>{const d=W(),f=N();d.palette.primary.main,d.palette.secondary.main,d.palette.info.main,d.palette.warning.main;const[_,S]=l.useState([]),[k,v]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const h=sessionStorage.getItem("token");if(!h){alert("Token defeated, enter again"),f("/auth/login");return}const p=new Headers;p.append("authToken",h);const y={method:"GET",headers:p,redirect:"follow"},m=await(await fetch(`${M.rutaApi}show_metrics_analytics_attrition`,y)).json();let t={Positive:0,Negative:0,Neutral:0,"No comment":0};m.forEach(a=>{if(a.calification)try{const c=a.calification.replace(/'/g,'"').replace(/([a-zA-Záéíóúñ]+):/g,'"$1":');let u=JSON.parse(c).Nivel;u==="Positivo"&&(u="Positive"),u==="Negativo"&&(u="Negative"),u==="Neutro"&&(u="Neutral"),u&&t.hasOwnProperty(u)?t[u]+=1:t["No comment"]+=1}catch{t["No comment"]+=1}else t["No comment"]+=1});const s=Object.values(t).reduce((a,c)=>a+c,0),r=Object.values(t).map(a=>s>0?parseFloat((a/s*100).toFixed(1)):0);S(r),v(!1)}catch(h){console.error(h),v(!1)}})()},[f]);const w=["Positive","Negative","Neutral","No comment"],C={labels:w,chart:{height:250,type:"donut",foreColor:"#adb0bb",fontFamily:"inherit",events:{dataPointSelection:(i,h,p)=>{const y=w[p.dataPointIndex];if(y){const b=y.toLowerCase().replace(" ","_");f(`/show_attrition_employee_customer/show_attrition_perspective?pers=${b}`)}}}},colors:["#589992","#C9ADCD","#8581B5","#255C82"],dataLabels:{enabled:!1},legend:{show:!1},stroke:{colors:["transparent"]},plotOptions:{pie:{donut:{size:"83",background:"transparent",labels:{show:!0,name:{show:!0,offsetY:7},value:{show:!1},total:{show:!0,color:"#a1aab2",fontSize:"13px",label:"Percentage %"}}}}},responsive:[{breakpoint:480,options:{chart:{height:230}}}],tooltip:{y:{formatter:function(i){return i.toFixed(1)+"%"}},theme:d.palette.mode==="dark"?"dark":"light",fillSeriesColor:!1}};return e.jsx(z,{title:"Job Satisfaction",subtitle:"",footer:e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(Y,{spacing:2,p:3,direction:"row",justifyContent:"center",flexWrap:"wrap",children:[{label:"Positive",color:"#589992"},{label:"Negative",color:"#C9ADCD"},{label:"Neutral",color:"#8581B5"},{label:"No comment",color:"#255C82"}].map((i,h)=>e.jsxs(Y,{direction:"row",spacing:1,alignItems:"center",sx:{m:.5},children:[e.jsx(ie,{sx:{width:9,height:9,bgcolor:i.color,svg:{display:"none"}}}),e.jsx(Z,{variant:"subtitle2",sx:{color:i.color},children:i.label})]},h))})]}),children:e.jsx(D,{height:"220px",children:e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Cargando gráfico..."}),children:!k&&_.length>0&&e.jsx(le,{options:C,series:_,type:"donut",height:250,width:"100%"})})})})},he=J.lazy(()=>V(()=>import("./react-apexcharts.min-DM8zd8sA.js").then(d=>d.r),__vite__mapDeps([0,1]))),ue=()=>{const d=N(),[f,_]=l.useState([]),[S,k]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const i=sessionStorage.getItem("token");if(!i){alert("Token defeated, enter again"),d("/auth/login");return}const h=new Headers;h.append("authToken",i);const p={method:"GET",headers:h,redirect:"follow"},b=await(await fetch(`${M.rutaApi}show_metrics_analytics_attrition`,p)).json();let m=0,t=0,s=0;b.forEach(c=>{if(c.clasification){const n=c.clasification.toLowerCase();n.includes("high")?m++:n.includes("medium")?t++:n.includes("low")&&s++}});const r=m+t+s,a=[parseFloat((m/r*100).toFixed(1)),parseFloat((t/r*100).toFixed(1)),parseFloat((s/r*100).toFixed(1))];_(a),k(!1)}catch(i){console.error(i),k(!1)}})()},[d]);const v=C=>{d(`/show_attrition_employee_customer/show_risk?risk=${encodeURIComponent(C)}`)},w={chart:{type:"radar",toolbar:{show:!1},events:{markerClick:(C,i,h)=>{const y=["High","Medium","Low"][h.dataPointIndex];y&&v(y)}}},xaxis:{categories:["High Risk","Medium Risk","Low Risk"]},markers:{size:5,colors:["#255C82"]},stroke:{width:2,colors:["#255C82"]},fill:{opacity:.1,colors:["#255C82"]},yaxis:{show:!1},tooltip:{y:{formatter:C=>`${C}%`}}};return e.jsx(z,{title:"Attrition Risk",subtitle:"",children:e.jsx(Y,{direction:"row",justifyContent:"center",children:e.jsx(D,{width:"400px",children:e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Cargando gráfico..."}),children:!S&&f.length>0&&e.jsx(he,{options:w,series:[{name:"Attrition Risk",data:f}],type:"radar",height:300})})})})})},fe=J.lazy(()=>V(()=>import("./react-apexcharts.min-DM8zd8sA.js").then(d=>d.r),__vite__mapDeps([0,1]))),me=()=>{const[d,f]=l.useState(!0),[_,S]=l.useState([]),k=N(),v=W();v.palette.primary.main;const[w,C]=l.useState([]),[i,h]=l.useState([]);l.useEffect(()=>{(async()=>{try{const t=sessionStorage.getItem("token");if(!t){y("Token defeated, enter again","error"),f(!1),k("/auth/login");return}const s=new Headers;s.append("authToken",t);const r={method:"GET",headers:s,redirect:"follow"},c=await(await fetch(`${M.rutaApi}show_metrics_analytics_attrition`,r)).json(),n={};c.forEach(g=>{const j=g.customer||"Unknown Client",o=g.clasification;n[j]||(n[j]={Low:0,Mid:0,High:0}),o.includes("Low")?n[j].Low+=1:o.includes("Medium")?n[j].Mid+=1:o.includes("High")&&(n[j].High+=1)});const u=Object.keys(n),B=u.map(g=>n[g].Low),L=u.map(g=>n[g].Mid),I=u.map(g=>n[g].High);C(u),h([{name:"Low Risk",data:B},{name:"Medium Risk",data:L},{name:"High Risk",data:I}]),f(!1)}catch(t){console.error("Error fetching data:",t),f(!1)}})()},[]);const p=(m,t)=>{k(`/show_attrition_employee_customer/show_attrition_employee_customer?cliente=${encodeURIComponent(m)}&riesgo=${encodeURIComponent(t)}`)},y=(m,t)=>{S(s=>[...s,{msg:m,severity:t}])},b={chart:{type:"bar",stacked:!0,foreColor:"#adb0bb",fontFamily:"inherit",toolbar:{show:!1},events:{dataPointSelection:function(m,t,s){const r=w[s.dataPointIndex],a=i[s.seriesIndex].name;p(r,a)}}},plotOptions:{bar:{horizontal:!0,borderRadius:4,barHeight:"60%"}},xaxis:{categories:w},legend:{position:"top"},fill:{opacity:1},colors:[v.palette.success.main,v.palette.warning.main,v.palette.error.main],tooltip:{y:{formatter:m=>`${m} empleados`}}};return e.jsx(e.Fragment,{children:e.jsx(z,{title:"Risk per client",subtitle:"",children:e.jsx(D,{height:"400px",children:e.jsx(fe,{options:b,series:i,type:"bar",height:400,width:"100%"})})})})};function Fe(){return N(),e.jsx(D,{children:e.jsxs(F,{container:!0,spacing:3,children:[e.jsx(F,{size:{xs:12,lg:8},children:e.jsx(ce,{})}),e.jsx(F,{size:{xs:12,lg:4},children:e.jsx(de,{})}),e.jsx(F,{size:{xs:12,lg:4},children:e.jsx(ue,{})}),e.jsx(F,{size:{xs:12,lg:8},children:e.jsx(me,{})})]})})}export{Fe as default};
